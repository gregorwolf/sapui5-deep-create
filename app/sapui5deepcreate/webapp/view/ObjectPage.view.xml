<mvc:View controllerName="udina.sample.sapui5deepcreate.controller.ObjectPage" displayBlock="true"
    xmlns:app="http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1"
    xmlns="sap.m" xmlns:core="sap.ui.core" xmlns:l="sap.ui.layout" xmlns:mvc="sap.ui.core.mvc" 
    xmlns:smartForm="sap.ui.comp.smartform" xmlns:smartField="sap.ui.comp.smartfield"
    xmlns:smartTable="sap.ui.comp.smarttable"
    xmlns:upload="sap.m.upload" xmlns:uxap="sap.uxap">
    <uxap:ObjectPageLayout id="ObjectPageLayout" showTitleInHeaderContent="true" 
        busy="{ui>/busy}" busyIndicatorDelay="{ui>/delay}"
        upperCaseAnchorBar="false" showFooter="{ui>/isEditable}">
        <uxap:headerTitle>
            <uxap:ObjectPageDynamicHeaderTitle id="ObjectPageHeader">
                <uxap:expandedHeading>
                    <Title text="{= ${ui>/isEditable} ? ${i18n>SalesOrderCreate} : ${i18n>SalesOrderDisplay}}" 
                        wrapping="true"/>
                </uxap:expandedHeading>
                <uxap:snappedHeading>
                    <Title text="{= ${ui>/isEditable} ? ${i18n>SalesOrderCreate} : ${i18n>SalesOrderDisplay}}" 
                        wrapping="true"/>
                </uxap:snappedHeading>
            </uxap:ObjectPageDynamicHeaderTitle>
        </uxap:headerTitle>
        <uxap:headerContent>
            <FlexBox wrap="Wrap" visible="{= !${ui>/isEditable}}">
                <l:VerticalLayout class="sapUiSmallMarginBeginEnd">
                    <Label text="{i18n>SalesOrder}"/>
                    <Text text="{SalesOrder}"/>
                </l:VerticalLayout>
			</FlexBox>
        </uxap:headerContent>
        <uxap:sections>
            <uxap:ObjectPageSection titleUppercase="false" title="{i18n>SalesOrderHead}">
                <uxap:subSections>
					<uxap:ObjectPageSubSection>
                        <smartForm:SmartForm id="SmartForm" editable="{ui>/isEditable}"
                        	app:defaultCheckBoxDisplayBehaviour="OnOff"
			                app:defaultDropDownDisplayBehaviour="idAndDescription">
                            <smartForm:layout>
				                <smartForm:ColumnLayout columnsM="2" columnsL="3" columnsXL="4"/>
			                </smartForm:layout>
                            <smartForm:Group>
                                <smartForm:GroupElement>
                                    <smartField:SmartField value="{PurchaseOrderByCustomer}"/>
                                </smartForm:GroupElement>
                                <smartForm:GroupElement>
                                    <smartField:SmartField value="{CustomerPurchaseOrderDate}"/>                                    
                                </smartForm:GroupElement>
                            </smartForm:Group>
                        </smartForm:SmartForm>
                    </uxap:ObjectPageSubSection>
                </uxap:subSections>
            </uxap:ObjectPageSection>
            <uxap:ObjectPageSection title="{i18n>SalesOrderItems}" titleUppercase="false" showTitle="false">
                <uxap:subSections>
					<uxap:ObjectPageSubSection>
                        <Table id="itemTable" width="auto" items="{to_Item}">
                            <headerToolbar>
                                <Toolbar>
                                    <ToolbarSpacer/>
                                    <Button text="Add" visible="{ui>/isEditable}" press=".onAddItem"/>
                                </Toolbar>
                            </headerToolbar>
                            <columns>
                                <Column width="12em">
                                    <Label text="Quantity" wrapping="true"/>
                                </Column>
                                <Column width="6em">
                                    <Label text="Unit" wrapping="true"/>
                                </Column>
                                <Column>
                                    <Label text="Material"/>
                                </Column>
                                <Column width="3em" visible="{ui>/isEditable}"/>
                            </columns>
                            <items>
                                <ColumnListItem>
                                    <cells>
                                        <StepInput value="{RequestedQuantity}"
                                            editable="{ui>/isEditable}"/>
                                        <smartField:SmartField value="{RequestedQuantityUnit}" 
                                            editable="{ui>/isEditable}"/>
                                        <smartField:SmartField value="{Material}"
                                            editable="{ui>/isEditable}"/>
                                        <Button icon="sap-icon://delete" type="Reject" 
                                            visible="{ui>/isEditable}" press=".onDeleteItem"/>
                                    </cells>
                                </ColumnListItem>
                            </items>
                        </Table>
                        <!-- Too many issues with SmartTable like editable only works onetime, eutoBinding not working -> rebindTable 
                        <smartTable:SmartTable id="smartTableItems" showRowCount="true" 
                            header="{i18n>SalesOrderItems}" tableType="ResponsiveTable"
                            editable="{ui>/isEditable}"
                            entitySet="SalesOrderItem" tableBindingPath="to_Item" enableAutoBinding="true" 
                            enableAutoColumnWidth="true"                                            
                            initiallyVisibleFields="RequestedQuantity,RequestedQuantityUnit,Material"
                            initialise=".onSmartTableInitialize">
                            <smartTable:layoutData>
                                <FlexItemData growFactor="1" baseSize="0%"/>
                            </smartTable:layoutData>
                            <smartTable:customToolbar>
                                <OverflowToolbar>
                                    <ToolbarSpacer/>
                                    <Button text="Add" visible="{ui>/isEditable}" press=".onAddItem"/>
                                    <ToolbarSeparator/>
                                </OverflowToolbar>                    
                            </smartTable:customToolbar>
                            <Table id="itemTable">
                                <columns>
                                    <Column width="12em">
                                        <customData>
                                            <core:CustomData key="p13nData"
                                                value='\{"columnKey": "RequestedQuantity", "columnIndex": 0}' />
                                        </customData>
                                        <Text text="{/SalesOrderItem/RequestedQuantity/#@sap:label}"/>
                                    </Column>
                                </columns>
                                <items>
                                    <ColumnListItem>
                                        <cells>
                                            <StepInput value="{RequestedQuantity}" editable="{ui>/isEditable}"/>
                                        </cells>
                                    </ColumnListItem>
                                </items>
                            </Table>                    
                        </smartTable:SmartTable>
                        -->
                    </uxap:ObjectPageSubSection>
                </uxap:subSections>
            </uxap:ObjectPageSection>
            <uxap:ObjectPageSection title="{i18n>SalesOrderAttachments}" titleUppercase="false" showTitle="false">
                <uxap:subSections>
					<uxap:ObjectPageSubSection>
                        <upload:UploadSet
                            id="UploadSet"
                            instantUpload="true"
                            uploadButtonInvisible="{= !${ui>/isEditable}}"
                            uploadEnabled="{ui>/isEditable}"                            
                            terminationEnabled="true"
                            fileTypes="txt,doc,png,pdf"
                            maxFileNameLength="30"
                            maxFileSize="5000"
                            mediaTypes="text/plain,application/msword,application/pdf,image/svg+xml,image/jpeg,image/png"
                            items="{path: 'to_Attachment', templateShareable: false}"
                            mode="None">
                            <upload:toolbar>
                                <OverflowToolbar>
                                    <Title text="{i18n>Attachments}" titleStyle="H4"/>
                                    <ToolbarSpacer/>
                                    <upload:UploadSetToolbarPlaceholder />
                                </OverflowToolbar>
                            </upload:toolbar>
                            <upload:items>
                                <upload:UploadSetItem
                                    fileName="{FileName}"
                                    mediaType="{MediaType}"
                                    url="{Url}"
                                    thumbnailUrl="{ThumbnailUrl}">
                                </upload:UploadSetItem>
                            </upload:items>
                        </upload:UploadSet>
                    </uxap:ObjectPageSubSection>
                </uxap:subSections>
            </uxap:ObjectPageSection>
        </uxap:sections>
        <uxap:footer>
            <OverflowToolbar>
                <Button icon="sap-icon://alert" text="{= ${message>/}.length }" type="Emphasized"
                    visible="{=${message>/}.length > 0}" press=".messageHandler.onMessagePopoverPress"/>
                <ToolbarSpacer/>
                <ToolbarSpacer/>
                <Button text="{i18n>Save}" type="Emphasized" press=".editFlow.onSave"/>
                <Button text="{i18n>SavePreProcessed}" press=".editFlow.onSavePreProcessed"/>
                <Button text="{i18n>Cancel}" press=".editFlow.onCancel"/>
            </OverflowToolbar>
        </uxap:footer>
    </uxap:ObjectPageLayout>
</mvc:View>
